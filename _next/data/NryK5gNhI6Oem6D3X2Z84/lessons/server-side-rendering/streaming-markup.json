{"pageProps":{"post":{"attributes":{"section":"Server Side Rendering"},"html":"<p>This is all cool, but we can make it <em>better</em>.</p>\n<p>With HTTP requests, you can actually send responses in chunks. This is called <em>streaming</em> your request. When you stream a request, you send partially rendered bits to your client so that the browser can immediately start processing the HTML rather than getting one big payload at the end. Really, the biggest win is that browser can immediately start downloading CSS while you&#39;re still rendering your app.</p>\n<p>Let&#39;s see how to do this:</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// change react-dom import</span>\n<span class=\"hljs-keyword\">import</span> { renderToNodeStream } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react-dom/server&quot;</span>;\n\n<span class=\"hljs-comment\">// replace app.use call</span>\napp.<span class=\"hljs-title function_\">use</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">req, res</span>) =&gt;</span> {\n  res.<span class=\"hljs-title function_\">write</span>(parts[<span class=\"hljs-number\">0</span>]);\n  <span class=\"hljs-keyword\">const</span> staticContext = {};\n  <span class=\"hljs-keyword\">const</span> reactMarkup = (\n    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">StaticRouter</span> <span class=\"hljs-attr\">url</span>=<span class=\"hljs-string\">{req.url}</span> <span class=\"hljs-attr\">context</span>=<span class=\"hljs-string\">{staticContext}</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">App</span> /&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">StaticRouter</span>&gt;</span></span>\n  );\n\n  <span class=\"hljs-keyword\">const</span> stream = <span class=\"hljs-title function_\">renderToNodeStream</span>(reactMarkup);\n  stream.<span class=\"hljs-title function_\">pipe</span>(res, { <span class=\"hljs-attr\">end</span>: <span class=\"hljs-literal\">false</span> });\n  stream.<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&quot;end&quot;</span>, <span class=\"hljs-function\">() =&gt;</span> {\n    res.<span class=\"hljs-title function_\">status</span>(staticContext.<span class=\"hljs-property\">statusCode</span> || <span class=\"hljs-number\">200</span>);\n    res.<span class=\"hljs-title function_\">write</span>(parts[<span class=\"hljs-number\">1</span>]);\n    res.<span class=\"hljs-title function_\">end</span>();\n  });\n});\n</code></pre>\n<ul>\n<li>Node has a native type called a stream. A stream, similar to a bash stream, is a stream of data that can be piped into something else. In this case, we have a Node stream of React markup being rendered. As each thing is rendered, React fires off a chunk that then can be sent to the user more quickly.</li>\n<li>First thing we do is <em>immediately</em> write the head to the user. This way they can grab the <code>&lt;head&gt;</code> which the CSS <code>&lt;link&gt;</code> tag in it, meaning they can start the CSS download ASAP.</li>\n<li>From there we start streaming the React markup to the user.</li>\n<li>After we finish with that stream, we write the end of the index.html page and close the connection.</li>\n</ul>\n<blockquote>\n<p>üèÅ <a href=\"https://github.com/btholt/citr-v6-project/tree/master/server-side-rendering-2\">Click here to see the state of the project up until now: server-side-rendering-2</a></p>\n</blockquote>\n","slug":"streaming-markup","title":"Streaming Markup","section":"Server Side Rendering","icon":"server","filePath":"/home/runner/work/next-react-v6/next-react-v6/lessons/12-server-side-rendering/B-streaming-markup.md","nextSlug":"/next-react-v6/lessons/typescript/refactor-modal","prevSlug":"/next-react-v6/lessons/server-side-rendering/server-side-rendering"}},"__N_SSG":true}